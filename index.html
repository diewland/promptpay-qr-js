<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PromptPay QR-Code Javascript Library</title>
    <script src="./promptpay-qr.js"></script>
    <script src="./qrcode.min.js"></script>
    <link href="./app.css" media="all" rel="stylesheet" />
  </head>
  <body>

    <h1>PromptPay QR Generator</h1>
    <h2>JavaScript Library</h2>

    <input id='acc_id' type='number' placeholder='เบอร์โทรศัพท์ หรือ เลขบัตรปชช' value='0812345678'><br>
    <input id='amount' type='number' placeholder='จำนวนเงิน (ไม่ระบุก็ได้)' min='1'><br>
    <button id='btn_download'>Download</button>
    Generate QR-Code by <a target='_blank' href='https://davidshimjs.github.io/qrcodejs/'>https://davidshimjs.github.io/qrcodejs</a>
    <div id="qrcode"></div>

    <!-- github button -->
    <a class="github-button" href="https://github.com/diewland/promptpay-qr-js" data-size="large" aria-label="Star diewland/promptpay-qr-js on GitHub">Star</a>
    <script async defer src="https://buttons.github.io/buttons.js"></script>

    <script type="text/javascript">
      
      // get QR-dom
      var qr_dom = document.getElementById('qrcode');

      // render QR function
      function render_qr(){
        var acc_id = document.getElementById('acc_id').value;
        var amount = document.getElementById('amount').value;
        var txt = PromptPayQR.gen_text(acc_id, amount);

        qr_dom.innerHTML = "";
        if(txt){
          new QRCode(qr_dom, txt);
        }
      }

      // download function
      function download() {
        // get b64
        let img = document.getElementsByTagName('img');
        if (img.length < 1) return;
        let b64 = img[0].src;
        // download image
        var link = document.createElement('a');
        link.href = b64;
        link.download = 'download.png';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      // bind acc_id, amount, download
      document.getElementById('acc_id').addEventListener('keyup', render_qr, true);
      document.getElementById('amount').addEventListener('keyup', render_qr, true);
      document.getElementById('btn_download').addEventListener('click', download);

      // preview qr
      render_qr();

    </script>

  </body>
</html>
